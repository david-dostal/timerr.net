{"version":3,"sources":["../../scripts/gui/alarm-gui.js"],"names":["alarm","enableButton","hoursInput","minutesInput","remainingElement","formElement","document","addEventListener","event","getElementById","localStorage","getItem","saveAlarmTarget","JSON","parse","h","m","value","toString","padStart","NumberInput","onclick","enableClick","Alarm","alarmFinished","getInputTime","updateRemaining","alert","Date","targetTime","toLocaleTimeString","innerText","unfreezeInputs","formatRemaining","remaining","mins","Math","round","decomposeTime","s","ms","parseInt","setItem","stringify","getState","AlarmState","DISABLED","inputsValid","freezeInputs","enable","ENABLED","disable","valid","validity","reportValidity","now","targetToday","getFullYear","getMonth","getDate","getTime","oneDay","setAttribute","removeAttribute"],"mappings":"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","file":"alarm-gui.js","sourcesContent":["let alarm;\r\nlet enableButton;\r\nlet hoursInput;\r\nlet minutesInput;\r\nlet remainingElement;\r\nlet formElement;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function (event) {\r\n    enableButton = document.getElementById('button-enable');\r\n    hoursInput = document.getElementById('hours-input');\r\n    minutesInput = document.getElementById('minutes-input');\r\n    remainingElement = document.getElementById('remaining-time');\r\n    formElement = document.getElementById('timer-time');\r\n\r\n    if(localStorage && localStorage.getItem('alarm-target-time') === null) {\r\n        saveAlarmTarget();\r\n    }\r\n    if(localStorage) {\r\n        let {h, m} = JSON.parse(localStorage.getItem('alarm-target-time'));\r\n        hoursInput.value = h.toString().padStart(2, '0');\r\n        minutesInput.value = m.toString().padStart(2, '0');\r\n    }\r\n\r\n    new NumberInput(hoursInput);\r\n    new NumberInput(minutesInput);\r\n\r\n    enableButton.onclick = enableClick;\r\n    alarm = new Alarm(() => alarmFinished(), getInputTime(), () => updateRemaining());\r\n});\r\n\r\nfunction alarmFinished() {\r\n    alert(`Beep Beep! It's ${new Date(alarm.targetTime()).toLocaleTimeString()}.`);\r\n    enableButton.innerText = 'Enable';\r\n    unfreezeInputs();\r\n}\r\n\r\nfunction updateRemaining() {\r\n    remainingElement.innerText = formatRemaining(alarm.remaining());\r\n}\r\n\r\nfunction formatRemaining(remaining) {\r\n    let mins = Math.round(remaining / (1000 * 60)) * 1000 * 60;\r\n    let {h, m, s, ms} = decomposeTime(mins);\r\n    return `${h}h ${m}m remaining`\r\n}\r\n\r\nfunction saveAlarmTarget() {\r\n    if(localStorage) {\r\n        let [h, m] = [parseInt(hoursInput.value), parseInt(minutesInput.value)];\r\n        localStorage.setItem('alarm-target-time', JSON.stringify({h: h, m: m}));\r\n    }\r\n}\r\n\r\nfunction enableClick() {\r\n    switch (alarm.getState()) {\r\n        case AlarmState.DISABLED:\r\n            if (inputsValid()) {\r\n                freezeInputs();\r\n                saveAlarmTarget();\r\n                alarm.enable(getInputTime());\r\n                enableButton.innerText = 'Disable alarm';\r\n            }\r\n            break;\r\n        case AlarmState.ENABLED:\r\n            alarm.disable();\r\n            unfreezeInputs();\r\n            enableButton.innerText = 'Enable alarm';\r\n            remainingElement.innerText = '';\r\n            break;\r\n    }\r\n}\r\n\r\nfunction inputsValid() {\r\n    let valid = hoursInput.validity.valid && minutesInput.validity.valid;\r\n    if(!valid) {\r\n        formElement.reportValidity();\r\n    }\r\n    return valid;\r\n}\r\n\r\nfunction getInputTime() {\r\n    let h = parseInt(hoursInput.value);\r\n    let m = parseInt(minutesInput.value);\r\n    let now = new Date();\r\n    let targetToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0);\r\n    if (targetToday.getTime() > now.getTime()) {\r\n        return targetToday.getTime();\r\n    } else {\r\n        let oneDay = 24 * 60 * 60 * 1000;\r\n        return targetToday.getTime() + oneDay;\r\n    }\r\n}\r\n\r\nfunction freezeInputs() {\r\n    hoursInput.setAttribute('readonly', '');\r\n    minutesInput.setAttribute('readonly', '');\r\n}\r\n\r\nfunction unfreezeInputs() {\r\n    hoursInput.removeAttribute('readonly');\r\n    minutesInput.removeAttribute('readonly');\r\n}\r\n"]}